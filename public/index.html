<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Review Response AI Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f2f5;
    }
    input, textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 1em;
    }
    .form-section {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .response-output {
      width: 100%;
      min-height: 120px;
      font-size: 1em;
      padding: 10px;
    }
    .input-error {
      border: 2px solid red;
    }
    .btn-group {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h1>ü§ñ Review Response AI Agent</h1>

  <div class="form-section">
    <label>Business Name</label>
    <input type="text" id="businessName" placeholder="e.g., Mario's Italian Restaurant" />

    <label>Business Type</label>
    <select id="businessType">
      <option value="restaurant">Restaurant</option>
      <option value="hotel">Hotel</option>
      <option value="retail">Retail</option>
    </select>

    <label>Owner Name</label>
    <input type="text" id="ownerName" />

    <label>Response Style</label>
    <select id="responseStyle">
      <option value="professional">Professional</option>
      <option value="friendly">Friendly</option>
    </select>

    <label>Business Info</label>
    <textarea id="businessInfo" rows="2"></textarea>
  </div>

  <div class="form-section">
    <label>Customer Name</label>
    <input type="text" id="customerName" />

    <label>Rating (1‚Äì5)</label>
    <input type="number" id="rating" min="1" max="5" />

    <label>Review Text</label>
    <textarea id="reviewText" rows="3"></textarea>

    <label>Review Platform</label>
    <select id="reviewPlatform">
      <option value="google">Google</option>
      <option value="yelp">Yelp</option>
    </select>

    <button class="generate-btn" onclick="generateResponse()">Generate Response</button>
  </div>

  <div class="form-section" id="loading" style="display:none;">
    <p>‚è≥ Generating response...</p>
  </div>

  <div class="form-section" id="responseSection" style="display: none;">
    <label>Generated Response</label>
    <textarea class="response-output" id="responseOutput" rows="6"></textarea>
    <div class="btn-group">
      <button onclick="copyResponse()">Copy</button>
      <button onclick="generateResponse()">Regenerate</button>
      <button onclick="clearForm()">Clear</button>
    </div>
  </div>

  <script>
    async function generateResponse() {
      const businessName = document.getElementById('businessName');
      const reviewText = document.getElementById('reviewText');
      const ratingInput = document.getElementById('rating');

      // Reset input errors
      [businessName, reviewText, ratingInput].forEach(el => el.classList.remove('input-error'));

      if (!businessName.value.trim()) {
        businessName.classList.add('input-error');
        alert("Please enter the business name.");
        return;
      }
      if (!reviewText.value.trim()) {
        reviewText.classList.add('input-error');
        alert("Please enter the review text.");
        return;
      }
      const rating = parseInt(ratingInput.value);
      if (!rating || rating < 1 || rating > 5) {
        ratingInput.classList.add('input-error');
        alert("Please enter a valid rating (1‚Äì5).");
        return;
      }

      document.querySelector('.generate-btn').disabled = true;
      document.querySelector('.generate-btn').textContent = 'Generating...';
      document.getElementById('loading').style.display = 'block';
      document.getElementById('responseSection').style.display = 'none';

      const data = {
        businessName: businessName.value,
        businessType: document.getElementById('businessType').value,
        ownerName: document.getElementById('ownerName').value,
        responseStyle: document.getElementById('responseStyle').value,
        businessInfo: document.getElementById('businessInfo').value,
        customerName: document.getElementById('customerName').value,
        reviewText: reviewText.value,
        reviewPlatform: document.getElementById('reviewPlatform').value,
        rating
      };

      try {
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        document.getElementById('responseOutput').value = result.response;
      } catch (err) {
        document.getElementById('responseOutput').value = '‚ùå Failed to generate response.';
        console.error(err);
      } finally {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('responseSection').style.display = 'block';
        document.querySelector('.generate-btn').disabled = false;
        document.querySelector('.generate-btn').textContent = 'Generate Response';
      }
    }

    function copyResponse() {
      const text = document.getElementById('responseOutput').value;
      navigator.clipboard.writeText(text).then(() => alert("‚úÖ Copied to clipboard!"));
    }

    function clearForm() {
      document.querySelectorAll('input, textarea').forEach(el => el.value = '');
      document.getElementById('responseSection').style.display = 'none';
    }
  </script>
</body>
</html>
